<html>
  <head>
    <title>TV</title>
  </head>

  <body>
    <script src="https://cdn.jsdelivr.net/npm/mpegts.js@1.7.3/dist/mpegts.min.js"></script>
    <script src="http://cdn.dashjs.org/latest/dash.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link href="https://vjs.zencdn.net/8.16.1/video-js.css" rel="stylesheet" />
    <script src="https://vjs.zencdn.net/8.16.1/video.min.js"></script>

    <h3>mpegts.js</h3>
    <video style="height:50%;width:50%" id="video1" controls></video>
    <h3>hls.js</h3>
    <video style="height:50%;width:50%" id="video2" controls></video>
    <h3>dash.js</h3>
    <video style="height:50%;width:50%" id="video3" controls></video>
    <h3>video.js HLS</h3>
    <video style="height:50%;width:50%" class="video-js" src="https://rtmp.howardchung.net/hls/tv.m3u8" id="video4" controls preload="auto"></video>
    <h3>video.js DASH</h3>
    <video style="height:50%;width:50%" class="video-js" src="https://rtmp.howardchung.net/dash/tv.mpd" id="video5" controls preload="auto"></video>

    <script type="module">
    const mpegtsPlayer = mpegts.createPlayer({
      isLive: true,
      // liveBufferLatencyChasing: true,
      // enableStashBuffer: false,
      type: "mpegts",
      url: "https://rtmp.howardchung.net/mpegts",
    });
    const video1 = document.getElementById("video1");
    mpegtsPlayer.attachMediaElement(video1);
    mpegtsPlayer.load();
    tryPlay(video1);

    const hls = new Hls();
    const video2 = document.getElementById("video2");
    hls.loadSource('https://rtmp.howardchung.net/hls/tv.m3u8');
    hls.attachMedia(video2);
    hls.on(Hls.Events.MANIFEST_PARSED, function() {
      tryPlay(video2);
    });

   const dash = dashjs.MediaPlayer().create();
   const video3 = document.getElementById("video3");
   dash.initialize(video3, 'https://rtmp.howardchung.net/dash/tv.mpd', true);
   tryPlay(video3);

   tryPlay(video4);
   tryPlay(video5);
    
   async function tryPlay(vidEl) {
      try {
        await vidEl.play();
      } catch (e) {
        console.log('autoplay disabled, muting');
        vidEl.muted = true;
        await vidEl.play();
      }
    }
    </script>
  </body>
</html>
